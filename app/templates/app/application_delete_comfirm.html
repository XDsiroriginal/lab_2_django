{% extends 'base.html' %}
{% load static %}
{% block title %}Подтверждение удаления{% endblock %}
{% block content %}
    <div class="main_container form-page-container">

        {% if user.is_authenticated %}
            <div class="card form-card delete-confirm-card">
                <h2 class="form-title form-title-danger">Подтверждение удаления заявки</h2>

                {% if application.status == 'n' %}

                    <div class="confirm-block">
                        <h3 class="confirm-warning">
                            Вы действительно хотите удалить заявку "{{ application.title }}"?
                        </h3>
                        <p class="confirm-text">
                            Это действие нельзя отменить. Удалить можно только заявки в статусе **"Новая"**.
                        </p>

                        <form action="{% url 'application_delete' pk=application.pk %}" method="post" class="delete-form-actions">
                            {% csrf_token %}
                            <button type="submit" class="btn-action btn-delete-confirm">
                                 Да, удалить навсегда
                            </button>
                            <a href="{% url 'profile' %}" class="btn-action btn-delete-cancel">
                                Отмена, вернуться в профиль
                            </a>
                        </form>
                    </div>

                {% else %}
                    <div class="status-restriction-block">
                        <h3 class="status-warning-title">Удаление невозможно</h3>
                        <p class="status-warning-text">
                            Заявка находится в статусе
                            <span class="status-value-text status-text-{{ application.status }}">
                                "{{ application.get_status_display }}"
                            </span>.
                            Удалять разрешено только заявки в статусе "Новая".
                        </p>
                        <a href="{% url 'profile' %}" class="btn-submit">
                            ← Вернуться в профиль
                        </a>
                    </div>
                {% endif %}

                <div class="detail-application-preview card-details-preview">
                    <h4 class="preview-title">Детали заявки:</h4>

                    <div class="preview-content-grid">
                        <div class="preview-image-wrapper">
                             <img src="{{ application.image.url }}"
                                 alt="{{ application.title }} image"
                                 class="preview-image-img">
                        </div>
                        <div class="preview-info">
                            <p class="preview-title-text">{{ application.title }}</p>
                            <p class="preview-meta-text">Дата: {{ application.date }}</p>
                            <p class="preview-meta-text">Категория: {{ application.categories }}</p>
                            <p class="preview-meta-text">
                                Статус:
                                <span class="status-value-text status-text-{{ application.status }}">
                                    {{ application.get_status_display }}
                                </span>
                            </p>
                            <p class="preview-description">{{ application.description|truncatechars:100 }}</p>

                            {% if perms.app.worker %}
                                <a href="{% url 'application_change' pk=application.pk %}" class="preview-action-link">
                                    Изменить заявку (Работник)
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

            </div>
        {% else %}
            <div class="card guest-card logout-card">
                <h3 class="guest-title guest-title-warning">Требуется вход</h3>
                <p class="guest-text">Для просмотра этой страницы необходимо войти на сайт.</p>

                <div class="guest-auth-actions">
                    <a href="{% url 'login' %}" class="btn-guest-login">Войти в аккаунт</a>
                    <a href="{% url 'index' %}" class="btn-profile btn-back-to-home">На главную</a>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}