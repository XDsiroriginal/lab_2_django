{% extends 'base.html' %}
{% load static %}
{% block title %}Детали заявки: {{ application.title }}{% endblock %}

{% block content %}
<div class="main_container detail-page-container">

    {% if user.is_authenticated %}
        <div class="card application-detail-card">

            <div class="detail-content-grid">

                <div class="detail-image-block">
                    <img src="{{ application.image.url }}"
                         alt="{{ application.title }} image"
                         class="detail-main-image">
                </div>

                <div class="detail-info-block">

                    <div class="detail-header">
                        <h2 class="detail-title">{{ application.title }}</h2>
                        <span class="detail-date">{{ application.date }}</span>
                    </div>

                    <div class="detail-meta-group">
                        <div class="detail-meta-item">
                            <span class="detail-meta-label">Статус:</span>
                            <span class="status-value-text status-text-{{ application.status }}">
                                {{ application.get_status_display }}
                            </span>
                        </div>
                        <div class="detail-meta-item">
                            <span class="detail-meta-label">Категория:</span>
                            <span class="detail-meta-value">{{ application.categories }}</span>
                        </div>
                    </div>

                    <div class="detail-description">
                        <h3 class="detail-section-title">Описание</h3>
                        <p>{{ application.description }}</p>
                    </div>

                    <div class="detail-comment">
                        <h3 class="detail-section-title">Комментарий работника</h3>
                        {% if application.comment %}
                            <p>{{ application.comment }}</p>
                        {% else %}
                            <p class="comment-none">Комментарий пока отсутствует.</p>
                        {% endif %}
                    </div>

                    <div class="detail-actions-panel">
                        {% if application.status == 'n' and perms.app.user and not perms.app.worker %}
                            <a href="{% url 'application_delete_comfirm' pk=application.pk %}" class="btn-action btn-delete-app">
                                 Удалить Заявку
                            </a>
                        {% endif %}

                        {% if perms.app.worker %}
                            <a href="{% url 'application_change' pk=application.pk %}" class="btn-action btn-change-app">
                                ️ Изменить статус/комментарий
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="detail-back-link-wrapper">
            <a href="{% url 'profile' %}" class="btn-profile btn-back-to-profile">
                ← Вернуться в профиль
            </a>
        </div>

    {% else %}
        <div class="guest-container">
            <div class="card guest-card">
                <h2 class="guest-title">Требуется авторизация</h2>
                <p class="guest-text">
                    Для просмотра этой заявки необходимо войти в систему.
                </p>

                <div class="guest-auth-actions">
                    <a href="{% url 'login' %}" class="btn-guest-login">Войти</a>
                    <a href="{% url 'register' %}" class="btn-guest-register">Зарегистрироваться</a>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}